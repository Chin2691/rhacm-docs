[#trouble-hosted-cluster-backplane]
= Must-gather for a hosted cluster

If you experience issues with a hosted cluster, you can run the `must-gather` command to gather information to help you with troubleshooting.

[#trouble-hosted-cluster-backplane-about-must-gather]
== About the must-gather command for hosted clusters

The `must-gather` command detects whether it is being run in a backplane operator location or in a managed cluster, and collects data accordingly.

If you run the command on the Open Cluster Management Hub Server, the command captures a list of managed clusters and their status. This information is in the `gather-managed.log` file. If a managed cluster reports a status that is not ready when you expect it to be ready, run the `must-gather` command on the managed cluster.

//lahinson - oct. 2023 - In the previous paragraph, the Open Cluster Management Hub Server is mentioned, although it isn't mentioned anywhere else on this page. Is it relevant to this page?

The data is organized in two levels:

* By cluster-scoped resources
* By resources that belong to namespaces

Within each level, the data is further organized by API group for the custom resource definitions.

The following information is also provided:

* The `kind` of each custom resource definition.
* The YAML for each of the custom resources.
* The output of the `kubectl get pods -n $NAMESPACE-IN-WHICH-OCM-RUNS-ON-HUB` command.
* The list of namespaces in the collected data, and the output of the namespaces.
* The list of pods that run in each namespace. If a namespace does not contain pods, no pods are displayed.
* Data from the hosting cluster:
** Cluster-scoped resources: Node definitions of the management cluster.
** Namespace resources: All of the objects from relevant namespaces, such as config maps, services, events, and logs.
** Network logs: The OVN northbound and southbound databases and their status.
** HostedCluster resources: All of the resources inside of the hosted cluster.
* Data from the hosted cluster:
** Cluster-scoped resources: All of the cluster-wide objects, such as nodes and custom resource definitions.
** Namespace resources: All of the objects from relevant namespaces, such as config maps, services, events, and logs.
** `hypershift-dump.tar.gz`: A compressed file of all of the data that was collected from both the hosting and hosted clusters.

The hosted cluster data collection does not contain any secret resources from the cluster, but it does contain references to the names of secrets.

[#trouble-hosted-cluster-backplane-must-gather-procedure]
== Entering the must-gather command for hosted clusters

. Enter the following command to collect information about the hosted cluster. In the command, the `hosted-cluster-namespace=HOSTEDCLUSTERNAMESPACE` parameter is optional; if you do not include it, the command runs as though the hosted cluster is in the default namespace, which is `clusters`.

+
----
oc adm must-gather --image=quay.io/stolostron/backplane-must-gather:SNAPSHOTNAME /usr/bin/gather hosted-cluster-namespace=HOSTEDCLUSTERNAMESPACE hosted-cluster-name=HOSTEDCLUSTERNAME 
----

. To save the results of the command to a compressed file, include the `--dest-dir=NAME` parameter, replacing `NAME` with the name of the directory where you want to save the results:

+
----
oc adm must-gather --image=quay.io/stolostron/backplane-must-gather:SNAPSHOTNAME /usr/bin/gather hosted-cluster-namespace=HOSTEDCLUSTERNAMESPACE hosted-cluster-name=HOSTEDCLUSTERNAME --dest-dir=NAME ; tar -cvzf NAME.tgz NAME
----

[#trouble-hosted-cluster-additional-resources-mce]
== Additional resources

* For more information about troubleshooting hosted control planes, see link:https://docs.openshift.com/container-platform/4.14/hosted_control_planes/hcp-troubleshooting.html[Troubleshooting hosted control planes] in the {ocp-short} documentation.