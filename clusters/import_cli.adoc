[#importing-a-managed-cluster-with-the-cli]
= Importing a managed cluster with the CLI

After you install {product-title}, you are ready to import a cluster to manage.
You can import from both the console and the CLI.
Follow this procedure to import from the CLI.

* <<cli-prerequisites,Prerequisites>>
* <<supported-architecture,Supported architecture>>
* <<importing-the-klusterlet,Importing the klusterlet>>

*Important:* A hub cluster cannot manage a different hub cluster. A hub cluster is set up to automatically import and manage itself. You do not have to manually import a hub cluster to manage itself. 

However, if you remove a hub cluster and try to import it again, you need to add the `local-cluster:true` label.

[#cli-prerequisites]
== Prerequisites

* You need a {product-title} hub cluster that is deployed.
If you are importing bare metal clusters, you must have the hub cluster installed on {ocp} version 4.6 or later. 
* You need a separate cluster that you want to manage and Internet connectivity.
* You need the {ocp} CLI version 4.6 or later, to run `oc` commands. See https://access.redhat.com/documentation/en-us/openshift_container_platform/4.8/html/cli_tools/openshift-cli-oc#cli-getting-started[Getting started with the OpenShift CLI] for information about installing and configuring the Red Hat OpenShift CLI, `oc`.
* You need to install the Kubernetes CLI, `kubectl`.
To install `kubectl`, see _Install and Set Up kubectl_ in the https://kubernetes.io/docs/tasks/tools/install-kubectl/[Kubernetes documentation].
+
*Note:* Download the installation file for CLI tools from the console.
* If you are importing a cluster that was not created by {ocp}, you need a `multiclusterhub.spec.imagePullSecret` defined. This secret might have been created when {product-title} was installed. See link:../install/install_connected.adoc#installing-from-the-operator-hub[Installing from the OperatorHub] for more information about defining the secret. 

[#supported-architecture]
== Supported architectures

* Linux (x86_64, s390x, ppc64le)
* macOS

[#prepare-for-import]
== Prepare for import

. Log in to your _hub cluster_.
Run the following command:
+
----
oc login
----

. Run the following command on the hub cluster to create the namespace.
*Note:* The cluster name that is defined in `<cluster_name>` is also used as the cluster namespace in the `.yaml` file file and commands:
+
----
oc new-project ${CLUSTER_NAME}
oc label namespace ${CLUSTER_NAME} cluster.open-cluster-management.io/managedCluster=${CLUSTER_NAME}
----

. Import the cluster by completing one of the following procedure. 

* To use automatic importing, you must create a secret containing either the kubeconfig or the server and token pair of the cluster to import. 
+
** To use the kubeconfig secret, add the following YAML content: 
+
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: auto-import-secret
  namespace: <cluster_name>
stringData:
  autoImportRetry: 5
  kubeconfig: |- 
  <The kubeconfig file that has the currentcontext set to the cluster to import>
type: Opaque
----

** To add the server/token pair of the cluster that you are importing, add the following YAML content: 
+
[source,yaml]
----
apiVersion: v1
kind: Secret
metadata:
  name: auto-import-secret
  namespace: <cluster_name>
stringData:
  autoImportRetry: 5
  token: <Token to access the cluster>
  server: <cluster_api_url>
type: Opaque
----

* To use the manual import process, complete the following steps
+
.. Edit the example ManagedCluster with the following sample of YAML:
+
----
apiVersion: cluster.open-cluster-management.io/v1
kind: ManagedCluster
metadata:
  name: <cluster_name>
spec:
  hubAcceptsClient: true
----

.. Save the file as `managed-cluster.yaml`.
.. Apply the YAML file with the following command:
+
----
oc apply -f managed-cluster.yaml
----

.. Create the klusterlet addon configuration file.
Enter the following example YAML:
+
----
apiVersion: agent.open-cluster-management.io/v1
kind: KlusterletAddonConfig
metadata:
  name: <cluster_name>
  namespace: <cluster_name>
spec:
  clusterName: <cluster_name>
  clusterNamespace: <cluster_name>
  applicationManager:
    enabled: true
  certPolicyController:
    enabled: true
  clusterLabels:
    cloud: auto-detect
    vendor: auto-detect
  iamPolicyController:
    enabled: true
  policyController:
    enabled: true
  searchCollector:
    enabled: true
  version: 2.2.0
----

.. Save the file as `klusterlet-addon-config.yaml`.
.. Apply the YAML by running the following command:
+
----
oc apply -f klusterlet-addon-config.yaml
----
+
**Note:** If you import a Red Hat OpenShift Dedicated cluster and do not specify a vendor by adding a label for `vendor=OpenShiftDedicated`, or if you add a label for `vendor=auto-detect`, a `managed-by=platform` label is automatically added to the cluster. You can use this added label to identify the cluster as a Red Hat OpenShift Dedicated cluster and retrieve the Red Hat OpenShift Dedicated clusters as a group.

The ManagedCluster-Import-Controller will generate a secret named `+${CLUSTER_NAME}-import+`. The `+${CLUSTER_NAME}-import+` secret contains the `import.yaml` that the user applies to a managed cluster to install klusterlet.

[#removing-imported-cluster-cli]

== Removing an imported cluster with the CLI

To remove a cluster, run the following command:
+
----
oc delete managedcluster <cluster_name>
----
+
Replace `cluster_name` with the name of the cluster.
