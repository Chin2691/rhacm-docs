[#accessing-metrics]
= Accessing the metrics service

You can use metrics to monitor the health of your fleet across components. See the following documentation:
//just an outline, these files do not exist until feedback from the team about what to include from open TOC

== Accessing the Metrics Service

____
This stepâ€™s goal is to manually expose and visit the collected metrics,
exposing the services is not required for
link:#scrapping-with-prometheus[Scrapping with Prometheus].
____

=== Hub Cluster Metrics

Note the _Service_:

[source,shell]
----
$ oc get svc -n open-cluster-management hub-subscription-metrics

NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
hub-subscription-metrics   ClusterIP   10.96.101.40   <none>        8381/TCP   28m
----

____
if missing, link:#hub-cluster-metrics-service-missing[create manually].
____

Expose the _Service_:

[source,shell]
----
oc port-forward -n open-cluster-management svc/hub-subscription-metrics 8381
----

Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected:

[source,shell]
----
$ curl http://localhost:8381/metrics

...
# HELP workqueue_adds_total Total number of adds handled by workqueue
# TYPE workqueue_adds_total counter
workqueue_adds_total{name="CSRApprovingController"} 10
workqueue_adds_total{name="addon-deploy-controller"} 15
workqueue_adds_total{name="addon-healthcheck-controller"} 16
workqueue_adds_total{name="addon-hook-deploy-controller"} 9
workqueue_adds_total{name="addon-install-controller"} 12
workqueue_adds_total{name="addon-registration-controller"} 10
workqueue_adds_total{name="cluster-management-addon-controller"} 9
workqueue_adds_total{name="mcmhub-subscription-controller"} 0
...
----

=== Managed Cluster Metrics

Note the _Service_:

____
Note the use of the non-conventional port 8388 (instead of the
conventional 8381).
____

[source,shell]
----
$ oc get svc -n open-cluster-management-agent-addon mc-subscription-metrics

NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
mc-subscription-metrics   ClusterIP   10.96.142.141   <none>        8388/TCP   74m
----

____
if missing, link:#managed-cluster-metrics-service-missing[create
manually].
____

Expose the _Service_:

[source,shell]
----
oc port-forward -n open-cluster-management-agent-addon svc/mc-subscription-metrics 8388
----

Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected:

[source,shell]
----
$ curl http://localhost:8388/metrics

...
# TYPE controller_runtime_max_concurrent_reconciles gauge
controller_runtime_max_concurrent_reconciles{controller="helmrelease-controller"} 10
controller_runtime_max_concurrent_reconciles{controller="klusterlet-token-controller"} 1
controller_runtime_max_concurrent_reconciles{controller="subscription-controller"} 1
# HELP controller_runtime_reconcile_errors_total Total number of reconciliation errors p
er controller
# TYPE controller_runtime_reconcile_errors_total counter
controller_runtime_reconcile_errors_total{controller="helmrelease-controller"} 0
controller_runtime_reconcile_errors_total{controller="klusterlet-token-controller"} 22
controller_runtime_reconcile_errors_total{controller="subscription-controller"} 0
...
----

=== Standalone Cluster Metrics

Note the _Service_:

____
Note the use of the non-conventional port 8389 (instead of the
conventional 8381).
____

[source,shell]
----
$ oc get svc -n open-cluster-management standalone-subscription-metrics

NAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
standalone-subscription-metrics   ClusterIP   10.96.225.150   <none>        8389/TCP   6m16s
----

____
if missing, link:#standalone-cluster-metrics-service-missing[create
manually].
____

Expose the _Service_:

[source,shell]
----
oc port-forward -n open-cluster-management svc/standalone-subscription-metrics 8389
----

Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected:

[source,shell]
----
$ curl http://localhost:8389/metrics

...
# TYPE controller_runtime_max_concurrent_reconciles gauge
controller_runtime_max_concurrent_reconciles{controller="helmrelease-controller"} 10
controller_runtime_max_concurrent_reconciles{controller="subscription-controller"} 1
...
----