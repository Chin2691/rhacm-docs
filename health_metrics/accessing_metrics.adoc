[#accessing-metrics]
= Accessing the metrics service

You can use metrics to monitor the health of your fleet across components. See the following documentation:
//just an outline, these files do not exist until feedback from the team about what to include from open TOC

[#accessing-hub-metrics]
== Accessing the hub cluster metrics service

To view the collected metrics, you must complete the following steps to expose the metrics service on the hub cluster.

. Run the following command and get the output:

+
----
oc get svc -n open-cluster-management hub-subscription-metrics
----
+
----
NAME                            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
hub-subscription-metrics   ClusterIP   10.96.101.40   <none>        8381/TCP   28m
----

. Run the following to expose the service:
+
----
oc port-forward -n open-cluster-management svc/hub-subscription-metrics 8381
----

. Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected in the output:

----
curl http://localhost:8381/metrics
----
+
----
workqueue_adds_total{name="CSRApprovingController"} 10
workqueue_adds_total{name="addon-deploy-controller"} 15
workqueue_adds_total{name="addon-healthcheck-controller"} 16
workqueue_adds_total{name="addon-hook-deploy-controller"} 9
workqueue_adds_total{name="addon-install-controller"} 12
workqueue_adds_total{name="addon-registration-controller"} 10
workqueue_adds_total{name="cluster-management-addon-controller"} 9
workqueue_adds_total{name="mcmhub-subscription-controller"} 0
----

[#accessing-managed-metrics]
== Accessing the managed cluster metrics service

To view the collected metrics, you must complete the following steps to expose the metrics service on the managed cluster.

Note the _Service_. Note the use of the non-conventional port 8388 (instead of the
conventional 8381).

. Run the following command and get the output:
+
----
oc get svc -n open-cluster-management-agent-addon mc-subscription-metrics
----
+
----
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
mc-subscription-metrics   ClusterIP   10.96.142.141   <none>        8388/TCP   74m
----

. Run the following command to expose the _Service_:

+
----
oc port-forward -n open-cluster-management-agent-addon svc/mc-subscription-metrics 8388
----

. Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected in the output:

----
curl http://localhost:8388/metrics
----

----
controller_runtime_max_concurrent_reconciles{controller="helmrelease-controller"} 10
controller_runtime_max_concurrent_reconciles{controller="klusterlet-token-controller"} 1
controller_runtime_max_concurrent_reconciles{controller="subscription-controller"} 1
controller_runtime_reconcile_errors_total{controller="helmrelease-controller"} 0
controller_runtime_reconcile_errors_total{controller="klusterlet-token-controller"} 22
controller_runtime_reconcile_errors_total{controller="subscription-controller"} 0
----

[#accessing-standalone-metrics]
== Accessing the standalone metrics service

To view the collected metrics, you must complete the following steps to expose the service on the hub cluster. *Note:* Standalone application subscriptions only deploy to the hub cluster and not managed clusters. As a result, there is no need to create manifest work, thus no propagation time.

Note the _Service_:
Note the use of the non-conventional port 8389 (instead of the
conventional 8381).

. Run the following command and get the output:

+
----
oc get svc -n open-cluster-management standalone-subscription-metrics
----
+
----
NAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
standalone-subscription-metrics   ClusterIP   10.96.225.150   <none>        8389/TCP   6m16s
----

. Run the following command to expose the _Service_:

+
----
oc port-forward -n open-cluster-management svc/standalone-subscription-metrics 8389
----

. Use _curl_ or your browser to visit the metrics endpoint and see the
various metrics collected in the output:

+
----
curl http://localhost:8389/metrics
----
+
----
controller_runtime_max_concurrent_reconciles{controller="helmrelease-controller"} 10
controller_runtime_max_concurrent_reconciles{controller="subscription-controller"} 1
----
