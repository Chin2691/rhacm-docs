[#volsync-convert-backup-pvc]
= Converting a replicated image to a usable persistent volume claim

When replicating or restoring a PVC via a ReplicationDestination using a VolumeSnapshot, the end result is a VolumeSnapshot that contains the latestImage from the last successful synchronization.
You might need to use the replicated image to recover data, or create a new instance of a persistent volume claim. The copy of the image must be converted to a persistent volume claim before it can be used.
The VolSync ReplicationDestination Volume Populator can be used to do this.

. Create a PVC with a `dataSourceRef` that points to the ReplicationDestination you want to restore to a PVC. This PVC will be populated with the contents of the VolumeSnapshot indicated in the status.latestImage of the ReplicationDestination.
+
Here is an example:
+
[source,yaml]
----
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: <pvc-name>
  namespace: <destination-ns>
spec:
  accessModes:
    - ReadWriteOnce
  dataSourceRef:
    kind: ReplicationDestination
    apiGroup: volsync.backube
    name: <replicationdestination_to_replace>
  resources:
    requests:
      storage: 2Gi
----
+
Replace `pvc-name` with a name for your new persistent volume claim.
+
Replace `destination-ns` with the namespace where the persistent volume claim (and ReplicationDestination) are located.
+
Replace `replicationdestination_to_replace` with the `ReplicationDestination` name.
+
**Best practice:** You can update `resources.requests.storage` with a different value when the value is at least the same size as the initial source persistent volume claim.

. Validate that your persistent volume claim is running in the environment by entering the following command:
+
----
$ kubectl get pvc -n <destination-ns>
----

Your original backup image is running as the main persistent volume claim.


Note:

If no latestImage exists yet, then the PVC will remain in pending state until the ReplicationDestination completes and a snapshot is available.
In this way you could create a ReplicationDestination and a PVC that uses the ReplicationDestination at the same time. The PVC will only start
the volume population process after the ReplicationDestination has completed a replication and a snapshot is available (as seen in `.status.latestImage`).

Additionally, if the storage class used has a volumeBindingMode of WaitForFirstConsumer, the volume populator will need to wait until there is a
consumer of the PVC before it gets populated. When a consumer does come along (for example a pod that wants to mount the PVC), then the volume
will be populated at that time. At this point the VolSync volume populator controller will take the latestImage from the ReplicationDestination,
which may have been updated if additional replications have occurred since the PVC was created.