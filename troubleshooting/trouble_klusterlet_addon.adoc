[#troubleshooting-klusterlet-add-on]
= Troubleshooting Klusterlet application manager on managed cluster

The `klusterlet-addon-appmgr` pod on {ocp} managed clusters version 4.5 and 4.6 are `OOMKilled`. 

[#symptom-klusterlet-application-manager]
== Symptom: Klusterlet application manager on managed cluster



[#resolving-klusterlet-application-manager]]
== Resolving the problem: Klusterlet application manager on managed cluster

For 2.1.Z and 2.2,  the issue workaround is to manually increase the memory limit of the pod to 8Gb. Here are the steps 
```
1. (On hub cluster) Annotate the klusterletaddonconfig to pause replication
    oc annotate klusterletaddonconfig -n ${CLUSTER_NAME} ${CLUSTER_NAME} klusterletaddonconfig-pause=true --  overwrite=true

2. (On hub cluster) Scale down the klusterlet-addon-operator
    oc edit manifestwork ${CLUSTER_NAME}-klusterlet-addon-operator -n ${CLUSTER_NAME}
    Find the klusterlet-addon-operator Deployment and add `replicas: 0` to the spec.

    - apiVersion: apps/v1
      kind: Deployment
      metadata:
        labels:
          app: cluster1
        name: klusterlet-addon-operator
        namespace: open-cluster-management-agent-addon
      spec:
        replicas: 0

3. Then on the managed cluster, the open-cluster-management-agent-addon/klusterlet-addon-operator pod will be terminated

so after scaling it down, we can go to the managed cluster to manually increase the memory limit in the appmgr pod. In this case, users see its memory usage is up to 5G. So may increase the limit to 8G

% oc edit deployments -n open-cluster-management-agent-addon klusterlet-addon-appmgr

        resources:
          limits:
            memory: 2Gi  -> 8Gi 
          requests:
            memory: 128Mi -> 256Mi
```

